<!DOCTYPE html>
<html lang="en"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ladder App — Totals & Charts</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;padding:16px;background:#f7f7f7}
h1{margin:0 0 12px}
.card{background:#fff;border:1px solid #e5e5e5;border-radius:12px;padding:12px;margin-bottom:12px}
label{font-size:13px;color:#444;display:block;margin:6px 0 4px}
input,button{font-size:15px;padding:8px;border:1px solid #ddd;border-radius:8px}
button{background:#0a7;color:#fff;border:none;cursor:pointer}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
canvas{max-width:100%;height:380px}
.total{font-weight:700;font-size:18px}
</style></head>
<body>
<h1>Ladder App — Totals & Charts</h1>

<div class="card grid">
  <div><div class="total">Portfolio Total: <span id="portfolioTotal">$0.00</span></div></div>
  <div>Year: <input type="number" id="year" value="2025"> <button onclick="calcYear()">Year Total</button> <span id="yearTotal"></span></div>
</div>

<div class="card">
  <div class="grid">
    <div><label>From</label><input type="date" id="from"></div>
    <div><label>To</label><input type="date" id="to"></div>
    <div style="align-self:end"><button onclick="updateChart()">Update Chart</button></div>
  </div>
  <canvas id="plChart"></canvas>
</div>

<div class="card">
  <p><b>How this demo works:</b> This file shows the new totals/chart features using in-page sample data. In your real app build, it will use your saved ladder rows (Sell Date + Actual Buy/Sell/Qty) to compute realized P/L, totals, and the chart.</p>
</div>

<script>
// Placeholder data to demonstrate the chart/totals mechanics.
// In your full app, this will read from your saved ladder entries.
let entries=[
  {date:'2025-01-02', aBuy:10.00, aSell:10.25, qty:100},
  {date:'2025-01-18', aBuy:11.00, aSell:10.60, qty:50},
  {date:'2025-02-04', aBuy:9.80,  aSell:10.40, qty:80},
  {date:'2025-03-10', aBuy:12.20, aSell:12.90, qty:40},
];

function realized(e){ return (e.aSell - e.aBuy) * e.qty; }

function updateTotals(){
  const t = entries.reduce((s,e)=> s + realized(e), 0);
  document.getElementById('portfolioTotal').textContent = '$' + t.toFixed(2);
}
updateTotals();

let chart;
function updateChart(){
  const from = document.getElementById('from').value;
  const to = document.getElementById('to').value;
  const filtered = entries.filter(e => (!from || e.date >= from) && (!to || e.date <= to))
                          .sort((a,b)=> a.date<b.date?-1:1);
  const labels = filtered.map(e=> e.date);
  const data = filtered.map(e=> realized(e));
  const ctx = document.getElementById('plChart').getContext('2d');
  if(chart) chart.destroy();
  chart = new Chart(ctx, {
    type: 'bar',
    data: { labels, datasets: [{ label:'Realized P/L', data }] },
    options: { scales:{ y:{ beginAtZero:true } } }
  });
}
updateChart();

function calcYear(){
  const y = String(document.getElementById('year').value||'');
  const total = entries.filter(e=> e.date.startsWith(y))
                       .reduce((s,e)=> s + realized(e), 0);
  document.getElementById('yearTotal').textContent = 'Total: $' + total.toFixed(2);
}
</script>
</body></html>
