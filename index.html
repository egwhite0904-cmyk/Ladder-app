<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ladder App</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f7fa; margin: 0; padding: 0; }
    header { background: linear-gradient(90deg, #00c6ff, #0072ff); color: white; padding: 12px; font-size: 20px; font-weight: bold; }
    .container { padding: 15px; }
    h2 { margin-top: 20px; }

    /* ---- Column alignment + numeric consistency ---- */
    table { width: 100%; border-collapse: collapse; margin-top: 10px; table-layout: fixed; }
    table colgroup col.col-idx   { width: 48px; }
    table colgroup col.col-buy   { width: 28%; }
    table colgroup col.col-sell  { width: 28%; }
    table colgroup col.col-ps    { width: 16%; }
    table colgroup col.col-shr   { width: 14%; }
    table colgroup col.col-tot   { width: 14%; }

    th, td { border: 1px solid #ccc; padding: 10px 12px; text-align: center; vertical-align: middle; }
    th { background: #e9ecef; }

    .num, .cell-num, table input[type="text"], table input[type="number"] {
      text-align: right;
      font-variant-numeric: tabular-nums lining-nums;
      -webkit-font-smoothing: antialiased;
      font-feature-settings: "tnum" 1, "lnum" 1;
    }

    table input[type="text"], table input[type="number"] {
      width: 100%;
      box-sizing: border-box;
      height: 38px;
      line-height: 38px;
      padding: 0 10px;
      border-radius: 10px;
      border: 1px solid #bbb;
    }

    .currency { display: block; text-align: right; }

    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    input[type=number] { -moz-appearance: textfield; }

    .controls { margin-top: 15px; }
    .btn { padding: 8px 14px; margin: 5px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; }
    .btn-green { background: #28a745; color: white; }
    .btn-red { background: #dc3545; color: white; }
    .btn-blue { background: #007bff; color: white; }
  </style>
</head>
<body>
<header>Ladder App</header>
<div class="container">
  <div>
    <label>Ticker / Name</label>
    <input type="text" id="ticker" placeholder="e.g., RIOT">
    <label>Rungs</label>
    <input type="number" id="rungs" value="3" min="1" max="4">
    <label>Start Price</label>
    <input type="number" id="startPrice" step="0.01">
    <label>Shares</label>
    <input type="number" id="shares" value="1">
    <button class="btn btn-green" onclick="addAsset()">+ Add Asset</button>
  </div>

  <div id="ladders"></div>
</div>

<script>
  let ladders = JSON.parse(localStorage.getItem("ladders") || "[]");

  function addAsset() {
    const ticker = document.getElementById("ticker").value || "TICKER";
    const rungs = parseInt(document.getElementById("rungs").value);
    const startPrice = parseFloat(document.getElementById("startPrice").value);
    const shares = parseInt(document.getElementById("shares").value);

    const sellPercents = [0.025, 0.045, 0.07, 0.10];
    const buybackPercents = [0.01, 0.025, 0.035, 0.05];

    let asset = { ticker, rungs, startPrice, shares, rows: [] };
    let currentPrice = startPrice;

    for (let i = 0; i < 20; i++) {
      let sell = currentPrice * (1 + sellPercents[(i % rungs)]);
      let buy = sell * (1 - buybackPercents[(i % rungs)]);
      let profit = (sell - currentPrice) * shares;

      asset.rows.push({
        plannedBuy: buy.toFixed(2),
        plannedSell: sell.toFixed(2),
        profitShare: profit.toFixed(2),
        plannedShares: shares,
        plannedTotal: (profit * shares).toFixed(2)
      });

      currentPrice = sell;
    }

    ladders.push(asset);
    localStorage.setItem("ladders", JSON.stringify(ladders));
    render();
  }

  function toggle(id) {
    const el = document.getElementById(id);
    el.style.display = (el.style.display === "none") ? "block" : "none";
  }

  function render() {
    const container = document.getElementById("ladders");
    container.innerHTML = "";
    ladders.forEach((asset, idx) => {
      let html = `
        <h2>${asset.ticker} (${asset.rungs} rung(s)) 
          <button class="btn btn-blue" onclick="toggle('ladder-${idx}')">Toggle</button>
          <button class="btn btn-red" onclick="deleteAsset(${idx})">Delete</button>
        </h2>
        <div id="ladder-${idx}">
          <table class="table">
            <colgroup>
              <col class="col-idx">
              <col class="col-buy">
              <col class="col-sell">
              <col class="col-ps">
              <col class="col-shr">
              <col class="col-tot">
            </colgroup>
            <thead>
              <tr>
                <th>#</th>
                <th>Planned Buy</th>
                <th>Planned Sell</th>
                <th>Profit/Share</th>
                <th>Planned Shares</th>
                <th>Planned Total</th>
              </tr>
            </thead>
            <tbody>`;
      asset.rows.forEach((row, i) => {
        html += `
          <tr>
            <td>${i + 1}</td>
            <td><input type="number" value="${row.plannedBuy}" /></td>
            <td><input type="number" value="${row.plannedSell}" /></td>
            <td class="cell-num"><span class="currency">$${row.profitShare}</span></td>
            <td><input type="number" value="${row.plannedShares}" /></td>
            <td class="cell-num"><span class="currency">$${row.plannedTotal}</span></td>
          </tr>`;
      });
      html += "</tbody></table></div>";
      container.innerHTML += html;
    });
  }

  function deleteAsset(i) {
    ladders.splice(i, 1);
    localStorage.setItem("ladders", JSON.stringify(ladders));
    render();
  }

  render();
</script>
</body>
</html>
