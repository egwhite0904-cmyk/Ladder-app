<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ladder App v2.1</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: green; }
    .note { font-size: 14px; color: #666; margin-bottom: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background: #f0f0f0; }
    button { margin: 5px; padding: 6px 10px; }
  </style>
</head>
<body>
  <h1>ðŸ“Š Ladder App</h1>
  <div class="note">Auto-save fixed â€¢ v2.1</div>

  <label>Ticker: <input id="ticker" placeholder="e.g. RIOT"></label>
  <label>Start Price: <input id="startPrice" type="number" step="0.01"></label>
  <label>Rungs:
    <select id="rungs">
      <option value="3">3</option>
      <option value="4">4</option>
    </select>
  </label>
  <button onclick="addAsset()">+ Add Asset</button>
  <button onclick="clearAll()">Clear All</button>

  <div id="ladders"></div>

<script>
let saveKey = "ladderAppData_v21";
let appData = JSON.parse(localStorage.getItem(saveKey) || "{}");

function saveData() {
  localStorage.setItem(saveKey, JSON.stringify(appData));
}

function clearAll() {
  if(confirm("Clear all ladders?")) {
    appData = {};
    saveData();
    render();
  }
}

function addAsset() {
  let ticker = document.getElementById("ticker").value.trim().toUpperCase();
  let startPrice = parseFloat(document.getElementById("startPrice").value);
  let rungs = parseInt(document.getElementById("rungs").value);
  if(!ticker || isNaN(startPrice)) return alert("Enter ticker + start price");
  appData[ticker] = { startPrice, rungs };
  saveData();
  render();
}

function render() {
  let div = document.getElementById("ladders");
  div.innerHTML = "";
  for(let t in appData) {
    let { startPrice, rungs } = appData[t];
    let html = `<h2>${t} â€” ${rungs} rung(s) â€¢ start $${startPrice.toFixed(2)}</h2>`;
    html += "<table><tr><th>#</th><th>Planned Buy</th><th>Planned Sell</th><th>Profit/Share</th></tr>";
    let sells = rungs===3 ? [0.025,0.045,0.07] : [0.025,0.045,0.07,0.09];
    let buys = [0.01,0.025,0.035,0.05];
    for(let i=0;i<rungs;i++) {
      let sell = startPrice * (1+sells[i]);
      let buy = sell * (1 - buys[i]);
      let profit = sell - buy;
      html += `<tr><td>${i+1}</td><td>${buy.toFixed(2)}</td><td>${sell.toFixed(2)}</td><td>$${profit.toFixed(2)}</td></tr>`;
    }
    html += "</table>";
    div.innerHTML += html;
  }
}

render();
</script>
</body>
</html>
